<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select Studio | Photo Selection</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script type="text/javascript">
        (function () {
            // Hi! Replace 'YOUR_PUBLIC_KEY' with your actual EmailJS Public Key from the dashboard.
            emailjs.init("YOUR_PUBLIC_KEY");
        })();
    </script>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div class="app-container">

        <!-- Sidebar / Header on Mobile -->
        <aside class="sidebar">
            <div class="sidebar-header"
                style="display:flex; align-items:center; justify-content:center; margin-bottom: 20px;">
                <img src="bilder/logo.jpeg" alt="NOWA Studio" style="height: 120px; mix-blend-mode: screen;">
            </div>

            <div class="package-selector">
                <label for="package-select" class="label-small">PAKET GRÖSSE</label>
                <div class="select-wrapper">
                    <select id="package-select" disabled>
                        <option value="0">Bewerbungsfoto Basic (0 Retuschen)</option>
                        <option value="1">Bewerbungsfotos Standard (1 Retusche)</option>
                        <option value="2">Bewerbungsfotos Advanced (2 Retuschen)</option>
                        <option value="3">Bewerbungsfotos Premium (3 Retuschen)</option>
                        <option value="4">Persönliche Portraits (4 Retuschen)</option>
                    </select>
                </div>
                <p style="font-size: 0.8rem; color: #888; margin-top: 10px; line-height: 1.4;">
                    Dein Paket enthält eine fixe Anzahl an Retuschen (siehe oben). Wähle deine Favoriten für die
                    Bearbeitung aus.
                </p>
            </div>

            <div class="selection-summary">
                <div class="counter-display">
                    <span id="current-count">00</span>
                    <span class="separator">/</span>
                    <span id="max-count">12</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>



                <div class="selected-list" id="selected-list">
                    <!-- Selected items will be injected here -->
                    <div class="empty-state">Noch keine Bilder ausgewählt.</div>
                </div>
            </div>

            <div class="sidebar-footer" style="display:flex; flex-direction:column; gap:10px;">
                <div id="buy-retouch-container"
                    style="border-top: 1px solid var(--color-border); padding-top: 15px; margin-bottom: 5px;">
                    <label class="label-small"
                        style="display: block; text-align: center; margin-bottom: 8px;">Zusätzliche Optionen (+10
                        CHF/Stück)</label>
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; background: var(--color-surface); border: 1px solid var(--color-border); border-radius: 6px; padding: 4px;">
                        <button class="btn-text" id="btn-remove-retouch"
                            style="padding: 0; font-size: 1.5rem; line-height: 1; color: var(--color-bg); width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; background: #333; border-radius: 4px; transition: background 0.2s;"
                            disabled>-</button>
                        <div style="font-size: 0.9rem; font-weight: bold;"><span id="extra-retouch-count"
                                style="font-size: 1.1rem; margin-right: 4px;">0</span> x Retusche</div>
                        <button class="btn-text" id="btn-add-retouch"
                            style="padding: 0; font-size: 1.5rem; line-height: 1; color: var(--color-bg); width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; background: var(--color-text); border-radius: 4px; transition: background 0.2s;">+</button>
                    </div>
                </div>
                <button id="btn-save-draft" class="btn-secondary" style="width:100%;">Auswahl speichern</button>
                <button id="submit-btn" class="btn-primary" disabled>Auswahl definitiv absenden</button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <header class="gallery-top-bar">
                <div class="gallery-info-bar">
                    <span id="gallery-title-text" style="font-weight: 600;">Main Gallery</span>
                </div>
                <div class="gallery-actions">
                    <button id="btn-share" class="btn-secondary">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
                            <polyline points="16 6 12 2 8 6"></polyline>
                            <line x1="12" y1="2" x2="12" y2="15"></line>
                        </svg>
                        Teilen
                    </button>
                    <!-- Admin Links -->
                    <a href="index.html" id="admin-link" class="btn-text"
                        style="display:none; font-size:0.8rem;">Dashboard</a>
                </div>
            </header>

            <div class="grid-container" id="photo-grid">
                <!-- Grid items will be injected here via JS -->
            </div>
        </main>

    </div>

    <!-- Retouch Modal -->
    <div class="modal-overlay" id="retouch-modal" hidden>
        <div class="modal-content">
            <header class="modal-header">
                <h2 id="modal-image-title">BILD #001</h2>
                <button class="close-btn" id="modal-close">&times;</button>
            </header>

            <div class="modal-body">
                <p class="modal-instruction">Wähle Retusche-Optionen (Optional):</p>
                <form id="retouch-form" class="retouch-options">
                    <label class="checkbox-wrapper">
                        <input type="checkbox" name="retouch" value="Augenringe">
                        <span class="custom-checkbox"></span>
                        <span class="label-text">Augenringe entfernen</span>
                    </label>
                    <label class="checkbox-wrapper">
                        <input type="checkbox" name="retouch" value="Zähne">
                        <span class="custom-checkbox"></span>
                        <span class="label-text">Zähne aufhellen</span>
                    </label>
                    <label class="checkbox-wrapper">
                        <input type="checkbox" name="retouch" value="Reflexionen">
                        <span class="custom-checkbox"></span>
                        <span class="label-text">Brillen-Reflexionen</span>
                    </label>
                    <label class="checkbox-wrapper">
                        <input type="checkbox" name="retouch" value="Haut">
                        <span class="custom-checkbox"></span>
                        <span class="label-text">Hautunreinheiten</span>
                    </label>
                    <label class="checkbox-wrapper">
                        <input type="checkbox" name="retouch" value="Hintergrund">
                        <span class="custom-checkbox"></span>
                        <span class="label-text">Hintergrund Clean-up</span>
                    </label>
                </form>
            </div>

            <div id="retouch-counter"
                style="text-align: right; font-size: 0.8rem; color: #aaa; margin-bottom: 10px; border-top: 1px solid #333; padding-top: 10px;">
                Retuschen (Gesamt): <span id="retouch-used" style="color: #fff; font-weight: bold;">0</span> / <span
                    id="retouch-max" style="color: #fff; font-weight: bold;">0</span>
            </div>

            <footer class="modal-footer" style="display: flex; justify-content: space-between; margin-top: 10px;">
                <button class="btn-text" id="modal-deselect" style="color: #ff4444;">BILD ABWÄHLEN</button>
                <div>
                    <button class="btn-text" id="modal-cancel">Abbrechen</button>
                    <button class="btn-primary" id="modal-save">SPEICHERN & AUSWÄHLEN</button>
                </div>
            </footer>
        </div>
    </div>

    <!-- Share Modal -->
    <div class="modal-overlay" id="share-modal" hidden>
        <div class="modal-content" style="max-width: 500px;">
            <header class="modal-header">
                <h2>Gallerie Teilen</h2>
                <button class="close-btn" id="share-close">&times;</button>
            </header>
            <div class="modal-body" style="padding: 20px 0;">

                <div style="margin-bottom: 20px;">
                    <label class="label-small" style="display:block; margin-bottom: 8px;">Link zum Bearbeiten
                        (Kunde)</label>
                    <p style="font-size: 0.8rem; color: #888; margin-bottom: 8px;">Kunde kann Bilder auswählen und
                        Favoriten markieren.</p>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="share-link-edit" readonly
                            style="flex:1; background: #222; border: 1px solid #444; padding: 10px; color: #fff; border-radius: 4px;">
                        <button class="btn-secondary" id="copy-edit">Kopieren</button>
                    </div>
                </div>

                <div style="border-top: 1px solid #333; padding-top: 20px;">
                    <label class="label-small" style="display:block; margin-bottom: 8px;">Link zum Anschauen
                        (Read-Only)</label>
                    <p style="font-size: 0.8rem; color: #888; margin-bottom: 8px;">Nur betrachten, keine Auswahl
                        möglich.</p>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="share-link-view" readonly
                            style="flex:1; background: #222; border: 1px solid #444; padding: 10px; color: #fff; border-radius: 4px;">
                        <button class="btn-secondary" id="copy-view">Kopieren</button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Lightbox -->
    <div id="lightbox" class="lightbox" hidden>
        <button id="lb-close" class="lb-close">&times;</button>
        <button id="lb-prev" class="lb-nav lb-prev">&#10094;</button>
        <button id="lb-next" class="lb-nav lb-next">&#10095;</button>

        <div class="lb-content">
            <img id="lb-img" src="" alt="">
        </div>

        <div class="lb-controls">
            <!-- Optional: Selection/Favorite button in lightbox -->
            <button id="lb-select-btn" class="btn-primary" style="padding: 8px 16px;">Auswählen</button>
        </div>
    </div>

    <!-- Limit Warning Toast -->
    <div id="toast" class="toast" hidden>
        Paket-Limit erreicht. Bitte entferne ein Bild, um ein neues zu wählen.
    </div>

    <!-- Admin: Add More Photos FAB -->
    <div id="admin-upload-fab" class="fab-container" hidden>
        <button id="btn-add-photos" class="fab-btn" title="Fotos hinzufügen (Admin)">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 5v14M5 12h14"></path>
            </svg>
        </button>
        <input type="file" id="admin-file-input" multiple accept="image/*" hidden>
    </div>

    <!-- Checkout Modal -->
    <div class="modal-overlay" id="checkout-modal" hidden>
        <div class="modal-content"
            style="max-width: 450px; text-align: center; padding: 30px; max-height: 90vh; overflow-y: auto;">
            <header class="modal-header" style="justify-content: center; margin-bottom: 5px;">
                <h2 style="font-size: 1.5rem;">Zusatzkosten begleichen</h2>
                <button class="close-btn" id="checkout-cancel"
                    style="position: absolute; right: 20px; top: 20px;">&times;</button>
            </header>

            <div class="modal-body" style="padding-top: 10px;">
                <p style="color: #aaa; font-size: 0.9rem; margin-bottom: 25px; line-height: 1.4;">
                    Du hast <strong id="checkout-retouch-count" style="color: #fff;">0</strong> zusätzliche Retuschen
                    ausgewählt.
                    Bitte überweise den Betrag von <strong id="checkout-total-price"
                        style="color: #fff; font-size: 1.1rem;">0 CHF</strong>, um deine Auswahl final
                    abzuschließen.
                </p>

                <!-- Payment Method Toggle -->
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <button class="btn-primary" id="btn-pay-twint" style="flex:1;">TWINT</button>
                    <button class="btn-secondary" id="btn-pay-iban" style="flex:1;">Banküberweisung</button>
                </div>

                <!-- TWINT Section -->
                <div id="payment-twint"
                    style="background: #fff; padding: 20px; border-radius: 12px; display: inline-block; margin-bottom: 20px; width: 100%; box-sizing: border-box;">
                    <!-- Placeholder TWINT QR Code / Replace with your actual TWINT business QR -->
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d0/QR_code_for_mobile_English_Wikipedia.svg/1200px-QR_code_for_mobile_English_Wikipedia.svg.png"
                        alt="TWINT QR Code"
                        style="width: 200px; height: 200px; object-fit: contain; margin-bottom: 10px;">
                    <p style="color: #000; font-weight: bold; margin: 0; font-size: 1.1rem;">TWINT an NOWA Studio</p>
                    <p style="color: #666; font-size: 0.8rem; margin: 5px 0 0 0;">Nummer xyz (Alternativ)</p>
                </div>

                <!-- IBAN Section -->
                <div id="payment-iban"
                    style="display: none; background: #222; padding: 20px; border-radius: 12px; border: 1px solid var(--color-border); margin-bottom: 20px; text-align: left;">
                    <div
                        style="background: #fff; padding: 10px; border-radius: 8px; margin-bottom: 15px; text-align: center;">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d0/QR_code_for_mobile_English_Wikipedia.svg/1200px-QR_code_for_mobile_English_Wikipedia.svg.png"
                            alt="IBAN QR Code" style="width: 150px; height: 150px; object-fit: contain;">
                    </div>

                    <label class="label-small" style="color: #888;">Empfänger</label>
                    <p style="color: #fff; font-size: 1rem; margin-bottom: 15px; font-weight: bold;">NOWA Studio</p>

                    <label class="label-small" style="color: #888;">IBAN</label>
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <input type="text" value="CH12 3456 7890 1234 5678 9" id="checkout-iban-input" readonly
                            style="flex: 1; background: transparent; border: 1px solid #444; color: #fff; padding: 8px; border-radius: 4px; font-family: monospace;">
                    </div>

                    <div
                        style="background: rgba(255,170,0,0.1); border-left: 3px solid #ffaa00; padding: 10px; margin-top: 15px;">
                        <span
                            style="font-weight: bold; color: #ffaa00; font-size: 0.85rem; display: block; margin-bottom: 5px;">WICHTIG:
                            Zahlungsmitteilung!</span>
                        <p style="color: #bbb; font-size: 0.85rem; margin: 0; line-height: 1.4;">
                            Zwingend in der App als "Mitteilung" eintragen (für die Zuordnung):<br>
                            <span id="checkout-email-ref"
                                style="color:#fff; font-weight:bold; font-size: 1rem; display: block; margin-top: 5px;"></span>
                        </p>
                    </div>
                </div>

                <div
                    style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 25px; text-align: left;">
                    <label class="checkbox-wrapper" style="margin: 0;">
                        <input type="checkbox" id="checkout-confirm-check">
                        <span class="custom-checkbox"></span>
                        <span class="label-text" style="font-size: 0.85rem;">Ich habe den Betrag überwiesen.</span>
                    </label>
                </div>

                <div style="display: flex; gap: 10px; flex-direction: column;">
                    <button class="btn-primary" id="checkout-submit"
                        style="width: 100%; padding: 12px; font-size: 1rem;" disabled>Jetzt Zahlung bestätigen &
                        Absenden</button>
                    <button class="btn-text" id="checkout-back" style="width: 100%; color: #aaa;">Abbrechen</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Compat SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

    <script src="services.js"></script>
    <script src="script.js"></script>
</body>

</html>